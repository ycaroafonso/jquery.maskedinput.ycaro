/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2013 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
	Version: 1.3.1
	
	
	2013 - by Ycaro Afonso - Inclusion of parameters in definitions: 
	1. allowKeepingIncomplete: false 
		a. Description: Keeps text even if it is incomplete.
		b. Exemple: 
			allowKeepingIncomplete: true
	2. defaultValue: ''
		a. Description: Default value
		b. Requirement: allowKeepingIncomplete: true
		b. Example: 
			defaultValue: "5567"; // result = "+55(67)____-____"
	3. dynamicMask: null //
		a. Description: Dynamic mask according to the number of characters
		b. Example: 
			dynamicMask: ["9999-9999", "(99)9999-9999"]
	
*/

(function(E){function G(){var I=document.createElement("input"),H="onpaste";I.setAttribute(H,"");return(typeof I[H]==="function")?"paste":"input"}var B=G()+".mask",D=navigator.userAgent,C=/iphone/i.test(D),A=/android/i.test(D),F;E.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_",allowKeepingIncomplete:false,defaultValue:"",dynamicMask:null};E.fn.extend({caret:function(J,H){var I;if(this.length===0||this.is(":hidden")){return}if(typeof J=="number"){H=(typeof H==="number")?H:J;return this.each(function(){if(this.setSelectionRange){this.setSelectionRange(J,H)}else{if(this.createTextRange){I=this.createTextRange();I.collapse(true);I.moveEnd("character",H);I.moveStart("character",J);I.select()}}})}else{if(this[0].setSelectionRange){J=this[0].selectionStart;H=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){I=document.selection.createRange();J=0-I.duplicate().moveStart("character",-100000);H=J+I.text.length}}return{begin:J,end:H}}},unmask:function(){return this.trigger("unmask")},mask:function(P,J){var N,L,H,I,O,M;var K=false;if(!P&&this.length>0){N=E(this[0]);return N.data(E.mask.dataName)()}J=E.extend({placeholder:E.mask.placeholder,completed:null,allowKeepingIncomplete:E.mask.allowKeepingIncomplete,defaultValue:E.mask.defaultValue,dynamicMask:E.mask.dynamicMask},J);L=E.mask.definitions;H=[];I=M=P.length;O=null;E.each(P.split(""),function(Q,R){if(R=="?"){M--;I=Q}else{if(L[R]){H.push(new RegExp(L[R]));if(O===null){O=H.length-1}}else{H.push(null)}}});return this.trigger("unmask").each(function(){var d=E(this),W=E.map(P.split(""),function(h,g){if(h!="?"){return L[h]?J.placeholder:h}}),f=d.val();function a(g){while(++g<M&&!H[g]){}return g}function X(g){while(--g>=0&&!H[g]){}return g}function V(l,g){var k,h;if(l<0){return}for(k=l,h=a(g);k<M;k++){if(H[k]){if(h<M&&H[k].test(W[h])){W[k]=W[h];W[h]=J.placeholder}else{break}h=a(h)}}Z();d.caret(Math.max(O,l))}function R(m){var k,l,g,h;for(k=m,l=J.placeholder;k<M;k++){if(H[k]){g=a(k);h=W[k];W[k]=l;if(g<M&&H[g].test(h)){l=h}else{break}}}}function Y(l){var h=l.which,m,j,g;if(h===8||h===46||(C&&h===127)){m=d.caret();j=m.begin;g=m.end;if(g-j===0){j=h!==46?X(j):(g=a(j-1));g=h===46?a(g):g}S(j,g);V(j,g-1);l.preventDefault()}else{if(h==27){d.val(f);d.caret(0,U());l.preventDefault()}else{if(!l.ctrlKey&&!l.altKey){for(i=0;i<J.dynamicMask.length;i++){if(P.length==d.val().replace(/\_/gi,"").length){if(P!=J.dynamicMask[i]&&J.dynamicMask[i].length>=d.val().replace(/\_/gi,"").length){d.mask(J.dynamicMask[i],J);d.val(d.val().replace(/\_/i,String.fromCharCode(h)));d.caret(d.val().indexOf("_")>-1?d.val().indexOf("_"):d.val().length);return}}}}}}}function e(l){var g=l.which,n=d.caret(),j,m,h;if(l.ctrlKey||l.altKey||l.metaKey||g<32){for(i=0;i<J.dynamicMask.length;i++){if(J.dynamicMask[i].length==d.val().replace(/\_/gi,"").length){if(P!=J.dynamicMask[i]){d.mask(J.dynamicMask[i],J);K=true;return}}}return}else{if(g){if(n.end-n.begin!==0){S(n.begin,n.end);V(n.begin,n.end-1)}j=a(n.begin-1);if(j<M){m=String.fromCharCode(g);if(H[j].test(m)){R(j);W[j]=m;Z();h=a(j);if(A){setTimeout(E.proxy(E.fn.caret,d,h),0)}else{d.caret(h)}if(J.completed&&h>=M){J.completed.call(d)}}}l.preventDefault()}}for(i=0;i<J.dynamicMask.length;i++){if(P.length==d.val().replace(/\_/gi,"").length){if(K){if(P!=J.dynamicMask[i]&&J.dynamicMask[i].length>=d.val().replace(/\_/gi,"").length){d.mask(J.dynamicMask[i],J);d.val(d.val().replace(/\_/i,String.fromCharCode(g)));d.caret(d.val().indexOf("_")>-1?d.val().indexOf("_"):d.val().length);return}}else{K=true;break}}}}function S(j,g){var h;for(h=j;h<g&&h<M;h++){if(H[h]){W[h]=J.placeholder}}}function Z(){d.val(W.join(""))}function U(h){if(J.allowKeepingIncomplete&&d.val().replace(/[^0-9]/gi,"")!=""){h=true}else{h=false}var l=d.val(),k=-1,g,j;for(g=0,pos=0;g<M;g++){if(H[g]){W[g]=J.placeholder;while(pos++<l.length){j=l.charAt(pos-1);if(H[g].test(j)){W[g]=j;k=g;break}}if(pos>l.length){break}}else{if(W[g]===l.charAt(pos)&&g!==I){pos++;k=g}}}if(h){Z()}else{if(k+1<I){d.val(J.defaultValue);if(J.defaultValue!=""){U()}S(0,M)}else{Z();d.val(d.val().substring(0,k+1))}}return(I?g:O)}function b(){U();if(d.val()!=f){d.change()}for(i=0;i<J.dynamicMask.length;i++){if(J.dynamicMask[i].length==d.val().replace(/\_/gi,"").length){d.mask(J.dynamicMask[i],J)}}}function Q(){setTimeout(function(){var g=U(true);d.caret(g);if(J.completed&&g==d.val().length){J.completed.call(d)}},0)}function c(){clearTimeout(F);var h,g;f=d.val();h=U();F=setTimeout(function(){Z();if(h==P.length){d.caret(0,h)}else{d.caret(h)}},10)}function T(){d.unbind(".mask").removeData(E.mask.dataName)}d.data(E.mask.dataName,function(){return E.map(W,function(h,g){return H[g]&&h!=J.placeholder?h:null}).join("")});if(!d.attr("readonly")){d.one("unmask",T).bind("focus.mask",c).bind("blur.mask",b).bind("keydown.mask",Y).bind("keypress.mask",e).bind(B,Q)}U()})}})})(jQuery);